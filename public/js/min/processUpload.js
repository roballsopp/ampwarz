"use strict";$(function(){function a(e){var t=new FormData;t.append("audio_file",e);i.find("input:not([type=file]), textarea").each(function(){t.append($(this).attr("name"),$(this).val())});var s=new XMLHttpRequest;s.open("POST","recieve.php",true);s.upload.onprogress=function(e){n.html("Uploading...");if(e.lengthComputable){r.val(e.loaded/e.total*100)}};s.onreadystatechange=function(){if(s.readyState==4&&s.status==200){document.open();document.write(s.response);document.close()}};s.send(t)}function f(){if(s.signal&&s.filter){n.html("begin processing..");var e=deconstruct(s.signal);var t=deconstruct(s.filter);var r=getBufferList(e).concat(getBufferList(t));o.postMessage({command:"process",signal:e,filter:t},r)}}function l(n){n.preventDefault();t.show();var r=e[0].files[0];u.postMessage({command:"decode",id:"signal",file:r})}var e=$("#input_file");var t=$("#progress");var n=$("#messages");var r=$("#progress_bar");var i=$("#frm_contribute");var s={signal:false,filter:false};var o=new Worker("js/Processor.js");var u=new Worker("js/FileParser.js");var c=new XMLHttpRequest;c.open("GET","files/site/cab_impulse.wav",true);c.responseType="blob";c.send();c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){u.postMessage({command:"decode",id:"filter",file:c.response})}};u.onmessage=function(e){var t=e.data.type;switch(t){case"error":n.html(e.data.message);break;case"status":n.html(e.data.message);break;case"progress":r.val(e.data.value);break;case"file":a(e.data.file);break;case"signal":s[e.data.id]=reconstruct(e.data.signal);f();break;default:console.log("Message not recognized")}};o.onmessage=function(e){var t=e.data.type;switch(t){case"error":n.html(e.data.message);break;case"status":n.html(e.data.message);break;case"progress":r.val(e.data.value);break;case"signal":var i=getBufferList(e.data.signal);u.postMessage({command:"encode",id:"signal",signal:e.data.signal,bitDepth:16},i);break;default:console.log("Message not recognized")}};i.on("submit",l)})